---
// src/pages/patients/[id].astro
import DashboardLayout from "../../layouts/DashboardLayout.astro";
import CameraRecorder from "../../components/CameraRecorder.astro";
import Button from "../../components/RecordButton.astro";

export function getStaticPaths() {
  return [
    { params: { id: '1' }, props: { name: 'Uncle Jhonny', age: 75, gender: 'Masculino' } },
    { params: { id: '2' }, props: { name: 'Isaac Miramontes Coronel', age: 54, gender: 'Masculino' } },
    { params: { id: '3' }, props: { name: 'Aunt Maria', age: 49, gender: 'Femenino' } },
  ];
}

const { id } = Astro.params;
const { name, age, gender } = Astro.props;
---

<DashboardLayout title={`Perfil: ${name}`}>
  <div class="page-container">
    
    <div class="patient-header">
      <div class="info">
        <h1>{name}</h1>
        <p>Edad: {age} a√±os | G√©nero: {gender}</p>
        <p class="patient-id">ID del paciente: #{id}</p>
      </div>
      <div class="actions">
        <Button id="btnAsistencia" variant="primary">
          Marcar Asistencia
        </Button>
      </div>
    </div>

    <div class="recorder-section">
      <h2>Sesi√≥n de Grabaci√≥n</h2>
      <p class="subtitle">Aseg√∫rate de marcar la asistencia antes de iniciar la grabaci√≥n.</p>
      
      <CameraRecorder />
    </div>

  </div>
</DashboardLayout>

<style>
  .page-container {
    padding: 1rem;
    max-width: 900px;
    margin: 0 auto;
  }
  
  .patient-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    padding: 1.5rem 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    margin-bottom: 2rem;
    border: 1px solid #eee;
  }

  .patient-header h1 {
    margin: 0 0 0.5rem 0;
    font-size: 1.8rem;
    color: #333;
  }

  .patient-header p {
    margin: 0;
    color: #666;
  }

  .patient-id {
    font-size: 0.85rem;
    color: #999 !important;
    margin-top: 0.25rem !important;
  }

  .recorder-section h2 {
    font-size: 1.5rem;
    margin-bottom: 0.2rem;
  }

  .subtitle {
    color: #666;
    margin-bottom: 1.5rem;
  }

  /* Peque√±a animaci√≥n para que el punto rojo parpadee al grabar */
  @keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btnAsistencia = document.getElementById('btnAsistencia') as HTMLButtonElement | null;
    const btnGrabar = document.getElementById('btnAccion') as HTMLButtonElement | null;
    const placeholder = document.querySelector('.video-placeholder') as HTMLElement | null;
    const videoFrame = document.querySelector('.video-frame') as HTMLElement | null;

    let isRecording = false;


    if (btnGrabar) {
      btnGrabar.disabled = true;
      btnGrabar.style.opacity = '0.5';
      btnGrabar.style.cursor = 'not-allowed';
    }

    btnAsistencia?.addEventListener('click', () => {
      if (btnAsistencia) {
        btnAsistencia.innerHTML = '‚úì Asistencia Marcada';
        btnAsistencia.style.backgroundColor = '#28a745'; 
        btnAsistencia.style.borderColor = '#28a745';
        btnAsistencia.style.pointerEvents = 'none'; 
      }

      if (placeholder && videoFrame) {
        videoFrame.style.backgroundColor = '#2c3e50'; 
        videoFrame.style.border = 'none';
        placeholder.innerHTML = '<span class="icon" style="font-size: 2rem;">üü¢</span><p style="color: white;">C√°mara encendida</p>';
      }

      if (btnGrabar) {
        btnGrabar.disabled = false;
        btnGrabar.style.opacity = '1';
        btnGrabar.style.cursor = 'pointer';
      }
    });

    btnGrabar?.addEventListener('click', () => {
      if (!isRecording) {
        if (btnGrabar) {
          btnGrabar.innerHTML = '‚èπ Detener Grabaci√≥n';
          btnGrabar.classList.remove('primary');
          btnGrabar.classList.add('danger');
        }
        
        if (placeholder) {
          placeholder.innerHTML = '<span class="icon" style="font-size: 2rem; animation: blink 1s infinite;">üî¥</span><p style="color: #ff4d4d; font-weight: bold;">Grabando...</p>';
        }
        isRecording = true;
      } else {
        if (btnGrabar) {
          btnGrabar.innerHTML = '‚ñ∂ Iniciar Grabaci√≥n';
          btnGrabar.classList.remove('danger');
          btnGrabar.classList.add('primary');
        }
        
        if (placeholder) {
          placeholder.innerHTML = '<span class="icon" style="font-size: 2rem;">üü¢</span><p style="color: white;">C√°mara encendida</p>';
        }
        isRecording = false;
      }
    });
  });
</script>
